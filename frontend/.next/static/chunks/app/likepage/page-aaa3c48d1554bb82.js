(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[275],{3874:(e,t,r)=>{Promise.resolve().then(r.bind(r,4945))},4945:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(5155),a=r(2115),i=r(5695),n=r(3464),o=r(1976),c=r(1366),l=r(1335);function u(){let e=(0,i.useRouter)(),[t,r]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{try{let t;let s=localStorage.getItem("token");if(!s){e.push("/login");return}try{t=(await n.A.get("http://127.0.0.1:8000/users/me",{headers:{Authorization:"Bearer ".concat(s)}})).data.user,localStorage.setItem("currentUser",JSON.stringify(t))}catch(t){console.error("Error fetching current user:",t),e.push("/login");return}let a=await n.A.get("http://127.0.0.1:8000/posts",{headers:{Authorization:"Bearer ".concat(s)}}),i=(Array.isArray(a.data)?a.data:a.data.results||a.data.posts||[]).filter(e=>{if(!e.liked_by)return!1;let r=e.liked_by.map(e=>String(e).trim()),s=String(t.user_id).trim();return r.includes(s)}),o=await Promise.all(i.map(async e=>{let t=e.user;if(!t)try{t=(await n.A.get("http://127.0.0.1:8000/users/".concat(e.user_id),{headers:{Authorization:"Bearer ".concat(s)}})).data.user}catch(r){t={username:e.user_id,avatar:"https://placehold.co/40x40?text=U"}}return{...e,avatar:t.avatar||"https://placehold.co/40x40?text=".concat(t.username||e.user_id),username:t.username||e.user_id,time:e.created_at?h(e.created_at):"",image:e.image_id?"http://127.0.0.1:8000/media/".concat(e.image_id):e.image||"",video:e.video_id?"http://127.0.0.1:8000/media/".concat(e.video_id):e.video||"",likes:"number"==typeof e.likes?e.likes:0,comments:"number"==typeof e.comments?e.comments:0,reposts:"number"==typeof e.reposts?e.reposts:0,saves:"number"==typeof e.saves?e.saves:0,created_at:e.created_at}}));r(o)}catch(e){console.error("Error fetching liked posts:",e)}finally{c(!1)}})()},[e]),(0,s.jsxs)("div",{className:"w-full h-screen bg-gray-100 flex flex-col items-center p-4",children:[(0,s.jsx)("h1",{className:"text-xl text-black font-bold mb-4",children:"B\xe0i viết đ\xe3 th\xedch"}),(0,s.jsx)("div",{className:"max-w-xl w-full h-auto",children:(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-md p-4 space-y-4",children:(0,s.jsx)("div",{className:"space-y-4 max-h-[85vh] overflow-y-auto",children:o?(0,s.jsx)("div",{className:"text-center py-4",children:"Đang tải..."}):0===t.length?(0,s.jsx)("div",{className:"text-center",children:"Bạn chưa th\xedch b\xe0i viết n\xe0o"}):t.map(e=>(0,s.jsx)(d,{...e,setLocalPosts:r,currentUser:JSON.parse(localStorage.getItem("currentUser")||"{}")},e._id||e.post_id))})})})]})}function d(e){let{post_id:t,user_id:r,avatar:n,username:u,time:d,content:p,image:f,video:x,likes:g,comments:y,reposts:v,saves:S,liked_by:_=[],reposted_by:j=[],created_at:k,setLocalPosts:b,currentUser:w}=e,[N,A]=(0,a.useState)(!1),[P,E]=(0,a.useState)(!1),[z,C]=(0,a.useState)(g),[B,F]=(0,a.useState)(!1),[O,R]=(0,a.useState)(v),[T,I]=(0,a.useState)(""),[U,M]=(0,a.useState)(y),[D,J]=(0,a.useState)(!1),[L,q]=(0,a.useState)(!1),[G,H]=(0,a.useState)(p),[K,Q]=(0,a.useState)(!1),V=(0,i.useRouter)(),W=localStorage.getItem("token"),[X,Y]=(0,a.useState)("");(0,a.useRef)(null);let[Z,$]=(0,a.useState)(!1),[ee,et]=(0,a.useState)(null),[er,es]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&W&&w&&(async()=>{try{let e=await fetch("http://127.0.0.1:8000/posts/".concat(t),{headers:{Authorization:"Bearer ".concat(W)},credentials:"include"});if(!e.ok)return;let r=await e.json();if(r&&Array.isArray(r.liked_by)){let e=r.liked_by.map(e=>String(e).trim()).includes(String(w.user_id).trim());E(e),C(r.likes)}if(r&&Array.isArray(r.reposted_by)){let e=r.reposted_by.map(e=>String(e).trim()).includes(String(w.user_id).trim());F(e),R(r.reposts)}}catch(e){console.error("Failed to fetch post:",e)}})()},[t,W,w]);let ea=async()=>{try{if(!W||!w)return;let r=await fetch("http://127.0.0.1:8000/posts/".concat(t,"/like"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(W)}});if(!r.ok)throw Error("Failed to like post");let s=await r.json();if(s&&s.liked_by){var e;let t=s.liked_by.map(e=>String(e).trim()).includes(String(w.user_id).trim());E(t),C(null!==(e=s.likes)&&void 0!==e?e:0)}}catch(e){console.error("Error liking post:",e)}},ei=async()=>{try{if(!W||!w)return;let r=await fetch("http://127.0.0.1:8000/posts/".concat(t,"/repost"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(W)}});if(!r.ok)throw Error("Failed to repost");let s=await r.json();if(s&&s.reposted_by){var e;let t=s.reposted_by.map(e=>String(e).trim()).includes(String(w.user_id).trim());F(t),R(null!==(e=s.reposts)&&void 0!==e?e:0)}}catch(e){console.error("Error reposting:",e)}};return(0,s.jsxs)("div",{className:"bg-white text-black p-4 shadow-md w-full rounded-lg border",children:[(0,s.jsx)("div",{className:"flex justify-between",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("img",{src:n?"http://127.0.0.1:8000/media/".concat(n):"https://placehold.co/40x40",alt:"Avatar",className:"w-10 h-10 rounded-full"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:u||r}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:d||(k?h(k):"")})]})]})}),(0,s.jsxs)("div",{onClick:()=>V.push("/comment/".concat(t)),children:[(0,s.jsx)("p",{className:"mt-2",children:p}),f&&(0,s.jsx)("img",{src:f,alt:"Post",className:"mt-2 rounded-lg"}),x&&(0,s.jsx)("video",{src:x,controls:!0,className:"mt-2 rounded-lg w-full"})]}),(0,s.jsxs)("div",{className:"flex gap-4 text-gray-500 mt-3",children:[(0,s.jsx)(m,{icon:(0,s.jsx)(o.A,{size:18,className:P?"text-red-500":"text-gray-500"}),count:z,onClick:ea}),(0,s.jsx)(m,{icon:(0,s.jsx)(c.A,{size:18}),count:U,onClick:()=>A(e=>!e)}),(0,s.jsx)(m,{icon:(0,s.jsx)(l.A,{size:18,className:B?"text-green-500":"text-gray-500"}),count:O,onClick:ei})]})]})}function m(e){let{icon:t,count:r,onClick:a}=e;return(0,s.jsxs)("button",{className:"flex items-center space-x-1 hover:text-black",onClick:e=>{e.stopPropagation(),null==a||a(e)},children:[t,(0,s.jsx)("span",{children:r})]})}function h(e){let t=new Date,r=new Date(e),s=Math.floor((t.getTime()-r.getTime())/6e4);if(s<60)return"".concat(s," ph\xfat");if(s<1440){let e=Math.floor(s/60);return"".concat(e," giờ")}{let e=Math.floor(s/1440);return"".concat(e," ng\xe0y")}}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"notFound")&&r.d(t,{notFound:function(){return s.notFound}}),r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[324,441,684,358],()=>t(3874)),_N_E=e.O()}]);