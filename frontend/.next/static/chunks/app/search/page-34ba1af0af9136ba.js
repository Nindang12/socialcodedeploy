(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{570:(e,t,r)=>{var o=r(4376),s=Object.prototype,a=s.hasOwnProperty,n=s.toString,i=o?o.toStringTag:void 0;e.exports=function(e){var t=a.call(e,i),r=e[i];try{e[i]=void 0;var o=!0}catch(e){}var s=n.call(e);return o&&(t?e[i]=r:delete e[i]),s}},709:(e,t,r)=>{Promise.resolve().then(r.bind(r,8933))},771:(e,t,r)=>{var o=r(8233),s=r(8611);e.exports=function(e){return"symbol"==typeof e||s(e)&&"[object Symbol]"==o(e)}},2500:(e,t,r)=>{var o=r(7985),s="object"==typeof self&&self&&self.Object===Object&&self;e.exports=o||s||Function("return this")()},4217:(e,t,r)=>{var o=r(6713),s=/^\s+/;e.exports=function(e){return e?e.slice(0,o(e)+1).replace(s,""):e}},4376:(e,t,r)=>{e.exports=r(2500).Symbol},4439:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5964:(e,t,r)=>{var o=r(7460),s=r(6685),a=r(6815),n=Math.max,i=Math.min;e.exports=function(e,t,r){var l,c,u,d,p,m,h=0,v=!1,f=!1,x=!0;if("function"!=typeof e)throw TypeError("Expected a function");function g(t){var r=l,o=c;return l=c=void 0,h=t,d=e.apply(o,r)}function b(e){var r=e-m,o=e-h;return void 0===m||r>=t||r<0||f&&o>=u}function y(){var e,r,o,a=s();if(b(a))return j(a);p=setTimeout(y,(e=a-m,r=a-h,o=t-e,f?i(o,u-r):o))}function j(e){return(p=void 0,x&&l)?g(e):(l=c=void 0,d)}function k(){var e,r=s(),o=b(r);if(l=arguments,c=this,m=r,o){if(void 0===p)return h=e=m,p=setTimeout(y,t),v?g(e):d;if(f)return clearTimeout(p),p=setTimeout(y,t),g(m)}return void 0===p&&(p=setTimeout(y,t)),d}return t=a(t)||0,o(r)&&(v=!!r.leading,u=(f="maxWait"in r)?n(a(r.maxWait)||0,t):u,x="trailing"in r?!!r.trailing:x),k.cancel=function(){void 0!==p&&clearTimeout(p),h=0,l=m=c=p=void 0},k.flush=function(){return void 0===p?d:j(s())},k}},6685:(e,t,r)=>{var o=r(2500);e.exports=function(){return o.Date.now()}},6713:e=>{var t=/\s/;e.exports=function(e){for(var r=e.length;r--&&t.test(e.charAt(r)););return r}},6815:(e,t,r)=>{var o=r(4217),s=r(7460),a=r(771),n=0/0,i=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return n;if(s(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=s(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=o(e);var r=l.test(e);return r||c.test(e)?u(e.slice(2),r?2:8):i.test(e)?n:+e}},7460:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},7985:(e,t,r)=>{e.exports="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g},8233:(e,t,r)=>{var o=r(4376),s=r(570),a=r(4439),n=o?o.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":n&&n in Object(e)?s(e):a(e)}},8611:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},8933:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var o=r(5155),s=r(2115),a=r(5695),n=r(3464),i=r(1976),l=r(1366),c=r(1335),u=r(5964),d=r.n(u),p=r(6874),m=r.n(p);function h(){let e=(0,a.useRouter)(),[t,r]=(0,s.useState)(""),[u,p]=(0,s.useState)("posts"),[h,v]=(0,s.useState)([]),[f,x]=(0,s.useState)(!1),[g,b]=(0,s.useState)(""),[y,j]=(0,s.useState)({}),[k,S]=(0,s.useState)({}),[_,N]=(0,s.useState)([]),[w,C]=(0,s.useState)([]),[A,T]=(0,s.useState)([]),[O,E]=(0,s.useState)([]),[I,z]=(0,s.useState)(null),B=(0,s.useCallback)(d()(e=>{if(!e.trim()){v([]);return}x(!0),b("");let t=localStorage.getItem("token"),r="";r="posts"===u?"http://127.0.0.1:8000/search/posts?query=".concat(encodeURIComponent(e)):"http://127.0.0.1:8000/search/users?query=".concat(encodeURIComponent(e)),n.A.get(r,{headers:{Authorization:"Bearer ".concat(t)}}).then(e=>{if("posts"===u){let t=e.data.results||[];v(t);let r={};t.forEach(e=>{var t,o;let s=null===(t=e.liked_by)||void 0===t?void 0:t.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim()),a=null===(o=e.reposted_by)||void 0===o?void 0:o.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim());r[e.post_id]={liked:s,likeCount:e.likes||0,reposted:a,repostCount:e.reposts||0}}),S(e=>({...e,...r}))}else v(e.data.users||[])}).catch(e=>{b("Kh\xf4ng t\xecm thấy kết quả hoặc c\xf3 lỗi xảy ra."),v([])}).finally(()=>{x(!1)})},500),[u,I]),P=e=>{p(e),v([]),b(""),t.trim()&&B(t)};(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");N((await n.A.get("http://127.0.0.1:8000/posts",{headers:{Authorization:"Bearer ".concat(e)}})).data.results||[])})()},[]),(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token");C((await n.A.get("http://127.0.0.1:8000/users",{headers:{Authorization:"Bearer ".concat(e)}})).data.results||[])})()},[]),(0,s.useEffect)(()=>{"posts"===u&&!t.trim()&&_.length>0&&T([..._].sort(()=>.5-Math.random()).slice(0,5))},[t,u,_,h]),(0,s.useEffect)(()=>{"users"===u&&!t.trim()&&w.length>0&&E([...w].sort(()=>.5-Math.random()).slice(0,5))},[t,u,w,h]),(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token"),t=await n.A.get("http://127.0.0.1:8000/users/me",{headers:{Authorization:"Bearer ".concat(e)}});z(t.data.user)}catch(t){let e=localStorage.getItem("currentUser");e&&z(JSON.parse(e))}})()},[]),(0,s.useEffect)(()=>{let e=async()=>{let e=Array.from(new Set(h.map(e=>e.user_id).filter(Boolean))).filter(e=>!y[e]);if(0===e.length)return;let t=localStorage.getItem("token"),r={};await Promise.all(e.map(async e=>{try{let o=await n.A.get("http://127.0.0.1:8000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}});r[e]=o.data.user}catch(e){}})),j(e=>({...e,...r}))};"posts"===u&&h.length>0&&e()},[h,u]);let M=async e=>{try{let r=localStorage.getItem("token"),o=await fetch("http://127.0.0.1:8000/posts/".concat(e.post_id,"/like"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(o.ok){var t;let r=await o.json(),s=null===(t=r.liked_by)||void 0===t?void 0:t.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim());S(t=>{var o,a,n,i;return{...t,[e.post_id]:{...t[e.post_id],liked:s,likeCount:null!==(i=null!==(n=null!==(a=r.likes)&&void 0!==a?a:null===(o=t[e.post_id])||void 0===o?void 0:o.likeCount)&&void 0!==n?n:e.likes)&&void 0!==i?i:0}}})}}catch(e){console.error("Error liking post:",e)}},q=async e=>{try{let r=localStorage.getItem("token"),o=await fetch("http://127.0.0.1:8000/posts/".concat(e.post_id,"/repost"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});if(o.ok){var t;let r=await o.json(),s=null===(t=r.reposted_by)||void 0===t?void 0:t.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim());S(t=>{var o,a,n,i;return{...t,[e.post_id]:{...t[e.post_id],reposted:s,repostCount:null!==(i=null!==(n=null!==(a=r.reposts)&&void 0!==a?a:null===(o=t[e.post_id])||void 0===o?void 0:o.repostCount)&&void 0!==n?n:e.reposts)&&void 0!==i?i:0}}})}}catch(e){console.error("Error reposting post:",e)}};return(0,o.jsxs)("div",{className:"w-full h-screen bg-gray-100 flex flex-col items-center p-4",children:[(0,o.jsx)("h1",{className:"text-xl font-bold mb-4",children:"T\xecm kiếm"}),(0,o.jsx)("div",{className:"max-w-xl w-full h-auto",children:(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-4 space-y-4",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{type:"text",placeholder:"T\xecm kiếm...",className:"w-full p-2 pl-10 border rounded-lg focus:outline-none",value:t,onChange:e=>{r(e.target.value),B(e.target.value)}}),(0,o.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,o.jsxs)("div",{className:"flex border-b",children:[(0,o.jsx)("button",{className:"px-4 py-2 ".concat("posts"===u?"border-b-2 border-blue-500 text-blue-500":"text-gray-500"),onClick:()=>P("posts"),children:"B\xe0i viết"}),(0,o.jsx)("button",{className:"px-4 py-2 ".concat("users"===u?"border-b-2 border-blue-500 text-blue-500":"text-gray-500"),onClick:()=>P("users"),children:"Người d\xf9ng"})]}),(0,o.jsxs)("div",{className:"space-y-4 min-h-[100px] overflow-y-auto max-h-[560px]",children:[f&&(0,o.jsx)("div",{className:"text-gray-400",children:"Đang t\xecm kiếm..."}),g&&(0,o.jsx)("div",{className:"text-red-500 text-sm",children:g}),!f&&!g&&0===h.length&&(0,o.jsx)("div",{className:"text-gray-400 text-sm",children:"Kh\xf4ng c\xf3 kết quả."}),"posts"===u&&h.map(t=>{var r,s,a,n,u,d,p;let m=y[t.user_id]||{},h=k[t.post_id]||{liked:null===(r=t.liked_by)||void 0===r?void 0:r.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim()),likeCount:t.likes||0,reposted:null===(s=t.reposted_by)||void 0===s?void 0:s.map(e=>String(e).trim()).includes(String(null==I?void 0:I.user_id).trim()),repostCount:t.reposts||0};return(0,o.jsxs)("div",{className:"bg-white text-black p-4 shadow-md w-full rounded-lg border hover:bg-gray-50 cursor-pointer mb-2 flex gap-3",onClick:()=>e.push("/comment/".concat(t.post_id)),children:[(0,o.jsx)("img",{src:m.avatar?"http://127.0.0.1:8000/media/".concat(m.avatar):"https://placehold.co/40x40",alt:"Avatar",className:"w-10 h-10 rounded-full"}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("span",{className:"font-semibold",children:m.username||"user"}),(0,o.jsx)("span",{className:"text-xs text-gray-500",children:t.created_at?function(e){let t=new Date,r=new Date(e),o=Math.floor((t.getTime()-r.getTime())/6e4);if(o<1)return"vừa xong";if(o<60)return"".concat(o," ph\xfat");if(o<1440){let e=Math.floor(o/60);return"".concat(e," giờ")}{let e=Math.floor(o/1440);return"".concat(e," ng\xe0y")}}(t.created_at):"time"})]}),(0,o.jsx)("div",{className:"mt-1 break-words",children:t.content}),t.image_id&&(0,o.jsx)("img",{src:"http://127.0.0.1:8000/media/".concat(t.image_id),alt:"Post",className:"mt-2 rounded-lg max-w-full"}),t.video_id&&(0,o.jsx)("video",{src:"http://127.0.0.1:8000/media/".concat(t.video_id),controls:!0,className:"mt-2 rounded-lg w-full"}),(0,o.jsxs)("div",{className:"flex gap-4 text-gray-500 mt-3",children:[(0,o.jsxs)("button",{className:"flex items-center space-x-1 hover:text-black",onClick:e=>{e.stopPropagation(),M(t)},children:[(0,o.jsx)(i.A,{className:h.liked?"text-red-500":"text-gray-500",size:18}),(0,o.jsx)("span",{children:null!==(n=null!==(a=h.likeCount)&&void 0!==a?a:t.likes)&&void 0!==n?n:0})]}),(0,o.jsxs)("button",{className:"flex items-center space-x-1 hover:text-black",onClick:r=>{r.stopPropagation(),e.push("/comment/".concat(t.post_id))},children:[(0,o.jsx)(l.A,{size:18}),(0,o.jsx)("span",{children:null!==(u=t.comments)&&void 0!==u?u:0})]}),(0,o.jsxs)("button",{className:"flex items-center space-x-1 hover:text-black",onClick:e=>{e.stopPropagation(),q(t)},children:[(0,o.jsx)(c.A,{className:h.reposted?"text-green-500":"text-gray-500",size:18}),(0,o.jsx)("span",{children:null!==(p=null!==(d=h.repostCount)&&void 0!==d?d:t.reposts)&&void 0!==p?p:0})]})]})]})]},t.post_id)}),"users"===u&&h.map(e=>(0,o.jsxs)(m(),{href:"/profile/".concat(e.user_id),className:"block p-2 border rounded mb-2 hover:bg-gray-100 transition",children:[(0,o.jsx)("div",{className:"font-semibold",children:e.username}),(0,o.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",e.user_id]})]},e.user_id))]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[244,324,441,684,358],()=>t(709)),_N_E=e.O()}]);